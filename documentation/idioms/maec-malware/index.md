---
layout: flat
title: Malware Characterization using MAEC
tags:
  - malware
  - ttp
summary: In addition to just naming a malware variety, it's occasionally useful to describe that malware's detailed behavior in a structured format. MAEC is a structured language for representing malware behavior and can be used within the STIX TTP construct to describe a detailed characterization of the malware for use in the broader context of campaigns, threat actors, indicators, incidents and exploit targets. This idiom describes the use of the TTP structure to carry a MAEC malware characterization and can serve as a building block to creating related TTPs in the use cases mentioned previously.
---

<img src="/images/Malware.png" class="component-img" alt="Malware Icon" />

Analyzing malware behavior is an important part of any threat intelligence organization's job. The results of this analysis whether from automated tools (static or dynamic) or from manual human analysis can be captured into a structured format called [MAEC](http://maec.mitre.org). MAEC (Malware Attribute Enumeration and Characterization) is a language similar to STIX that is used to describe malware behavior from the very low technical level up to the more abstract contextual levels of behaviors and capabilities. When representing threat intelligence in STIX, it can occasionally be useful to include a full representation of the malware behavior using MAEC in order to share it with other parties or relate its behavior to other pieces of intelligence in STIX.

## Scenario

In this scenario, the STIX describes a particular variant of Poison Ivy by giving it a name, a type, and a full characterization in MAEC.

## Data model

<img src="diagram.png" alt="Malware characterization in MAEC" class="aside-text"/>

The portion of the TTP data model that is used to represent malware is [MalwareInstanceType](/data-model/{{site.current_version}}/ttp/MalwareInstanceType), which is represented as a list of `Malware Instance` fields inside the TTP [BehaviorType](/data-model/{{site.current_version}}/ttp/BehaviorType) structure.

[MalwareInstanceType](/data-model/{{site.current_version}}/ttp/MalwareInstanceType) is a STIX extension point that can either be used as-is to represent basic information (name, type) about malware or can be extended to represent full malware expressions. The STIX default extension is the [MAEC4.1InstanceType](/data-model/{{site.current_version}}/stix-maec/MAEC4.1InstanceType) extension that uses MAEC to characterize the malware.

## XML

{% highlight xml linenos %}
<stix:TTP xsi:type="ttp:TTPType" id="example:ttp-7d9fe1f7-429d-077e-db51-92c70b8da45a">
    <ttp:Title>Poison Ivy Variant v4392-acc</ttp:Title>
    <ttp:Behavior>
        <ttp:Malware>
            <ttp:Malware_Instance xsi:type="stix-maec:MAEC4.1InstanceType">
                <ttp:Type xsi:type="stixVocabs:MalwareTypeVocab-1.0">Remote Access Trojan</ttp:Type>
                <ttp:Name>Poison Ivy Variant v4392-acc</ttp:Name>
                <stix-maec:MAEC>
                    <!-- MAEC Content Here --> 
                </stix-maec:MAEC>                        
            </ttp:Malware_Instance>
        </ttp:Malware>
    </ttp:Behavior>
</stix:TTP>
{% endhighlight %}

[Full XML](malware-characterization-using-maec.xml)

## Python

{% highlight python linenos %}
from stix.ttp import TTP, Behavior
from stix.extensions.malware.maec_4_1_malware import MAECInstance

maec_malware_instance = MAECInstance()
maec_malware_instance.add_name("Poison Ivy Variant v4392-acc")
maec_malware_instance.add_type("Remote Access Trojan")
maec_malware_instance.maec = __INSERT_MAEC_ETREE_HERE__

ttp = TTP(title="Poison Ivy Variant v4392-acc")
ttp.behavior = Behavior()
ttp.behavior.add_malware_instance(maec_malware_instance)

print ttp.to_xml()
{% endhighlight %}

[Full Python](malware-characterization-using-maec.py)

## Further Reading

* [MAEC](http://maec.mitre.org)
* [TTP Component](/data-model/{{site.current_version}}/ttp/TTPType)
* [MalwareInstanceType](/data-model/{{site.current_version}}/ttp/MalwareInstanceType)

An example of using this type of structure in another context is found in the [malware hash](../../indicator/malware-hash) idiom. The simple representation described there could be replaced with a full MAEC characterization as described here.
